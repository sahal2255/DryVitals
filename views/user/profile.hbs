<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description"
    content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

  <!-- title -->
  <title>Profile</title>

  <!-- favicon -->
  {{!--
  <link rel="shortcut icon" type="image/png" href="/assets/img/favicon.png"> --}}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- google font -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
  <!-- fontawesome -->
  <link rel="stylesheet" href="/assets/css/all.min.css">
  <!-- bootstrap -->
  <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">
  <!-- owl carousel -->
  <link rel="stylesheet" href="/assets/css/owl.carousel.css">
  <!-- magnific popup -->
  <link rel="stylesheet" href="/assets/css/magnific-popup.css">
  <!-- animate css -->
  <link rel="stylesheet" href="/assets/css/animate.css">
  <!-- mean menu css -->
  <link rel="stylesheet" href="/assets/css/meanmenu.min.css">
  <!-- main style -->
  <link rel="stylesheet" href="/assets/css/main.css">
  <!-- responsive -->
  <link rel="stylesheet" href="/assets/css/responsive.css">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f8f9fa;
    }

    .profile-container {
      background-color: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .profile-container h1 {
      font-size: 24px;
      margin-bottom: 20px;
    }

    .profile-container p {
      font-size: 16px;
      margin-bottom: 15px;
    }

    .profile-container hr {
      border-top: 1px solid #ddd;
      margin-top: 30px;
      margin-bottom: 30px;
    }

    .options a {
      text-decoration: none;
      color: #fff;
      padding: 10px 20px;
      border-radius: 5px;
      background-color: #007bff;
      transition: background-color 0.3s;
      display: block;
      margin-bottom: 10px;
    }

    .options a:hover {
      background-color: #0056b3;
    }

    .edit-address-btn {
      background-color: #28a745;
    }

    .edit-address-btn:hover {
      background-color: #218838;
    }

    .modal-title {
      font-size: 24px;
      margin-bottom: 20px;
    }

    .modal-body input[type="text"],
    .modal-body input[type="email"],
    .modal-body input[type="password"],
    .modal-body textarea {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ced4da;
      margin-bottom: 15px;
    }

    .modal-body .error-msg {
      color: red;
      margin-top: 5px;
    }

    .modal-footer .btn-secondary {
      background-color: #6c757d;
      border-color: #6c757d;
    }

    .modal-footer .btn-secondary:hover {
      background-color: #5a6268;
      border-color: #545b62;
    }

    .modal-footer .btn-primary {
      background-color: #007bff;
      border-color: #007bff;
    }

    .modal-footer .btn-primary:hover {
      background-color: #0056b3;
      border-color: #0056b3;
    }
    .error{
      color: red;
    }
  </style>
</head>

<body>

  <!--PreLoader-->
  {{!-- <div class="loader">
    <div class="loader-inner">
      <div class="circle"></div>
    </div>
  </div> --}}
  <!--PreLoader Ends-->

  <!-- header -->
  <div class="top-header-area" id="sticker">
    <div class="container">
      <div class="row">
        <div class="col-lg-12 col-sm-12 text-center">
          <div class="main-menu-wrap">
            <!-- logo -->
            <div class="site-logo">
              <a href="/">
                <img src="/assets/img/mainLogo.png" alt="">
              </a>
            </div>
            <!-- logo -->

            <!-- menu start -->
            <nav class="main-menu">
              <ul>
                {{!-- <li class="current-list-item"><a href="/">Home</a>
                  <ul class="sub-menu">
                    <li><a href="index.html">Static Home</a></li>
                    <li><a href="index_2.html">Slider Home</a></li>
                  </ul>
                </li> --}}
                <li><a href="/product">Product</a></li>
                <li><a href="#">Pages</a>
                  <ul class="sub-menu">
                    {{!-- <li><a href="404.html">404 page</a></li> --}}
                    {{!-- <li><a href="about.html">About</a></li> --}}
                    <li><a href="/cart">Cart</a></li>
                    <li><a href="/checkout">Check Out</a></li>
                    <li><a href="/product">Product</a></li>
                    <li><a href="/order">Order</a></li>
                  </ul>
                </li>

                {{!-- <li><a href="contact.html">Contact</a></li> --}}
                <li><a href="/product">Shop</a>
                  <ul class="sub-menu">
                    <li><a href="/product">Product</a></li>
                    {{!-- <li><a href="checkout.html">Check Out</a></li> --}}
                    {{!-- <li><a href="/singleProduct">Single Product</a></li> --}}
                    <li><a href="/cart">Cart</a></li>
                  </ul>
                </li>
                <li>
                  <div class="header-icons">
                    {{!-- <a class="mobile-hide search-bar-icon" href="#" id="search-icon"><i
                        class="fas fa-search"></i></a> --}}
                    <a class="shopping-cart" href="/cart"><i class="fas fa-shopping-cart"></i></a>
                    <a class="mobile-hide wishlist-bar-icon" href="/wishlist"><i class="bi bi-heart-fill"></i></a>
                    <a class="mobile-hide person-bar-icon" href="/profile"><i class="bi bi-person-circle"></i></a>
                  </div>

                </li>

              </ul>
            </nav>
            <a class="mobile-show search-bar-icon" href="#"><i class="fas fa-search"></i></a>
            <div class="mobile-menu"></div>
            <!-- menu end -->
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- end header -->

  <!-- search area -->
  <div class="search-area">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <span class="close-btn"><i class="fas fa-window-close"></i></span>
          <div class="search-bar">
            <div class="search-bar-tablecell">
              <h3>Search For:</h3>
              <input type="text" placeholder="Keywords">
              <button type="submit">Search <i class="fas fa-search"></i></button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- end search arewa -->

  <!-- breadcrumb-section -->
  <div class="breadcrumb-section breadcrumb-bg">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 offset-lg-2 text-center">
          <div class="breadcrumb-text">
            <p>Dryc Vitals</p>
            <h1>Profile</h1>
          </div>
        </div>
      </div>
    </div>
  </div>




  <div class="container mt-5 ">
    <div class="row justify-content-center">
      <div class="col-md-4 col-sm-12">
        <div class="profile-container">
          <h1 class="mb-3">{{ user.userName }}</h1>
          <p class="mb-4">{{ user.email }}</p>
          <p class="mb-4">{{user.phoneNumber}}</p>
          <hr>
          <div class="options">
            <a href="/wishlist" class="btn p- "><i class="fas fa-heart me-1 "></i> Wishlist</a>
            <a href="/cart" class="btn "><i class="fas fa-shopping-cart me-1"></i> Cart</a>
            <a href="/order" class="btn "><i class="fas fa-box-open me-1"></i> Order</a>
            {{!-- <button type="button" class="edit-address-btn" data-bs-toggle="modal"
              data-bs-target="#staticBackdrop">
              <i class="fas fa-edit me-1"></i> Edit Address
            </button> --}}
            <a href="#" class="btn" data-bs-toggle="modal" data-bs-target="#changePasswordModal"> Change Details</a>
            <a href="/logOut" class="btn "><i class="fas fa-sign-out-alt me-1"></i> Logout</a>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="user-details">

          {{#each user.userAddress}}
          <div class="card mb-4">
            <div class="card-body">
              <p class="card-text"><strong>Address:</strong> {{address}}</p>
              <p class="card-text"><strong>Place:</strong> {{place}}</p>
              <p class="card-text"><strong>District:</strong> {{district}}</p>
              <p class="card-text"><strong>Pincode:</strong> {{pincode}}</p>

              <a href="#" class="btn btn-primary edit-address-btn" data-bs-toggle="modal"
                data-bs-target="#staticBackdrop" data-id="{{_id}}">
                <i class="fas fa-edit"></i><input type="hidden" value="{{_id}}"> Edit Address
              </a>

            </div>
          </div>
          {{/each}}
        </div>



        	<p class="d-inline-flex gap-1">
								<button class="btn btn-primary" type="button" data-bs-toggle="collapse"
									data-bs-target="#collapseExample" aria-expanded="false"
									aria-controls="collapseExample">
									Add Address
								</button>
							</p>
							<div class="collapse" id="collapseExample">
								<div class="card card-body">
									<!-- Address form -->
									<form id="addressForm" action="/saveAddress" method="POST" onsubmit="return saveAddress(event)">
    <div class="row mb-3">
        <label for="inputAddress" class="col-sm-2 col-form-label">Address</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="address" placeholder="Address" name="address">
        <p id="addressError" class="error"></p> <!-- Error message for address -->
        </div>
    </div>
    <div class="row mb-3">
        <label for="inputCity" class="col-sm-2 col-form-label">District</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="district" name="district" placeholder="District">
        <p id="districtError" class="error"></p> <!-- Error message for district -->
        </div>
    </div>
    <div class="row mb-3">
        <label for="inputState" class="col-sm-2 col-form-label">Place</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="place" name="place" placeholder="Place">
        <p id="placeError" class="error"></p> <!-- Error message for place -->
        </div>
    </div>
    <div class="row mb-3">
        <label for="inputZip" class="col-sm-2 col-form-label">Pincode</label>
        <div class="col-sm-10">
            <input type="number" class="form-control" id="pincode" name="pincode" placeholder="Pincode">
        <p id="pincodeError" class="error"></p> <!-- Error message for pincode -->
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-sm-10 offset-sm-2">
            <button type="button" class="btn btn-primary" id="submitAddress">Save Address</button>
        </div>
    </div>
</form>

								</div>
							</div>
      </div>


    </div>
  </div>


  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Edit Address</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="edit-address-form">

            <div class="mb-3">
  <label for="edit-address" class="form-label">Address</label>
  <textarea class="form-control" id="edit-address" name="address" rows="3">{{ addressDetails.address.address }}</textarea>
  <p class="error-msg" id="address-error"></p>
</div>
<div class="mb-3">
  <label for="edit-place" class="form-label">Place</label>
  <input type="text" class="form-control" id="edit-place" name="place" value="{{ addressDetails.address.place }}">
  <p class="error-msg" id="place-error"></p>
</div>
<div class="mb-3">
  <label for="edit-district" class="form-label">District</label>
  <input type="text" class="form-control" id="edit-district" name="district" value="{{ addressDetails.address.district }}">
  <p class="error-msg" id="district-error"></p>
</div>
<div class="mb-3">
  <label for="edit-pincode" class="form-label">Pincode</label>
  <input type="text" class="form-control" id="edit-pincode" name="pincode" value="{{ addressDetails.address.pincode }}">
  <p class="error-msg" id="pincode-error"></p>
</div>

            
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <input type="hidden" id="addressId">
          <button type="button" id="savebtn" class="btn btn-primary" >Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- New modal for changing password -->
  {{!-- <div class="modal fade" id="changePasswordModal" data-bs-backdrop="static" data-bs-keyboard="false"
    tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="changePasswordModalLabel">Change User Details</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Form for changing password -->
          <form id="change-password-form">
            <div class="mb-3">
              <label for="name" class="form-label">Name</label>
              <input type="text" class="form-control" id="name" name="name" value="{{user.userName}}">
              <p class="error-msg" id="nameError"></p>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" name="email" value="{{user.email}}">
              <p class="error-msg" id="emailError"></p>
            </div>
            <div class="mb-3">
              <label for="phone" class="form-label">Phone Number</label>
              <input type="tel" class="form-control" id="phone" name="phone" value="{{user.phoneNumber}}">
              <p class="error-msg" id="phoneError"></p>
            </div>
            <div class="mb-3">
              <label for="current-password" class="form-label">Current Password</label>
              <input type="password" class="form-control" id="current-password" name="currentPassword"
                value="{{user.password}}">
              <p class="error-msg" id="current-password-error"></p>
            </div>
            <div class="mb-3">
              <label for="new-password" class="form-label">New Password</label>
              <input type="password" class="form-control" id="new-password" name="newPassword">
              <p class="error-msg" id="new-password-error"></p>
            </div>
            <div class="mb-3">
              <label for="confirm-password" class="form-label">Confirm Password</label>
              <input type="password" class="form-control" id="confirm-password" name="confirmPassword">
              <p class="error-msg" id="confirm-password-error"></p>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <input type="hidden" name="userId" value="{{user._id}}">
          <button type="button" class="btn btn-primary" onclick="changePassword()">Save Changes</button>
        </div>
      </div>
    </div>
  </div> --}}

  <script>


    document.querySelectorAll('.edit-address-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const addressId = this.dataset.id;
        console.log('address id', addressId)
        axios.get(`/profile/editaddress/${addressId}`)
          .then(response => {
            // Handle response, populate modal fields
            const addressDetails = response.data;
            console.log(addressDetails)
            //console.log('address pincode', addressDetails.address.pincode);
            document.getElementById('edit-address').value = addressDetails.address.address;
            document.getElementById('edit-place').value = addressDetails.address.place;
            document.getElementById('edit-district').value = addressDetails.address.district;
            document.getElementById('edit-pincode').value = addressDetails.address.pincode;
            document.getElementById('addressId').value=addressDetails.address._id


          })
          .catch(error => {
            console.error('Error fetching address details:', error);
          });
      });
    });

document.getElementById('savebtn').addEventListener('click', function () {
  const addressId = document.getElementById('addressId').value;
  const newAddress = document.getElementById('edit-address').value;
  const newPlace = document.getElementById('edit-place').value;
  const newDistrict = document.getElementById('edit-district').value;
  const newPincode = document.getElementById('edit-pincode').value;

  const newData = {
    
    address: newAddress,
    place: newPlace,
    district: newDistrict,
    pincode: newPincode
  };
  console.log('address edit id',addressId)

  axios.post(`/profile/editaddress/${addressId}`, newData)
    .then(response => {
      console.log('Address details updated successfully:', response.data);
    })
    .catch(error => {
      console.error('Error updating address details:', error);
    });
});


document.addEventListener("DOMContentLoaded", function() {
    document.getElementById("submitAddress").addEventListener("click", saveAddress);
});

async function saveAddress(event) {
    event.preventDefault();

    var district = document.getElementById("district").value;
    var place = document.getElementById("place").value.trim();
    var address = document.getElementById("address").value.trim();
    var pincode = document.getElementById("pincode").value.trim();

    // Reset error messages
    document.getElementById("districtError").innerText = "";
    document.getElementById("placeError").innerText = "";
    document.getElementById("addressError").innerText = "";
    document.getElementById("pincodeError").innerText = "";

    // Validation
    var isValid = true;

    if (district === "") {
        document.getElementById("districtError").innerText = "Please enter your district";
        isValid = false;
    }

    if (place === "") {
        document.getElementById("placeError").innerText = "Please enter your place";
        isValid = false;
    }

    if (address === "") {
        document.getElementById("addressError").innerText = "Please enter your address";
        isValid = false;
    }

    if (pincode === "") {
        document.getElementById("pincodeError").innerText = "Please enter your pincode";
        isValid = false;
    } else if (!isValidPincode(pincode)) {
        document.getElementById("pincodeError").innerText = "Pincode should be exactly 6 digits";
        isValid = false;
    }

    if (isValid) {
        try {
            // Construct the new address object
            const newAddress = {
                district: district,
                place: place,
                address: address,
                pincode: pincode
            };

            // Send a request to your server to update the user's address
            const response = await axios.post('/saveAddress', { newAddress });

            // Handle the response from the server
            console.log('Address saved successfully:', response.data);
            // Show SweetAlert notification
            Swal.fire({
                icon: 'success',
                title: 'Success',
                text: 'Your address has been saved successfully!',
                confirmButtonText: 'OK'
            }).then((result) => {
                window.location.href = '/profile';
            });
        } catch (error) {
            console.error('Error saving address:', error);
            // Show SweetAlert for error
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'Something went wrong! Please try again later.',
                confirmButtonText: 'OK'
            });
        }
    }
}

function isValidPincode(pincode) {
    // Pincode validation (6 digits)
    var pincodeRegex = /^\d{6}$/;
    return pincodeRegex.test(pincode);
}




  </script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js"
    integrity="sha512-PJa3oQSLWRB7wHZ7GQ/g+qyv6r4mbuhmiDb8BjSFZ8NZ2a42oTtAq5n0ucWAwcQDlikAtkub+tPVCw4np27WCg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- jquery -->
  <script src="/assets/js/jquery-1.11.3.min.js"></script>
  <!-- bootstrap -->
  <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
  <!-- count down -->
  <script src="/assets/js/jquery.countdown.js"></script>
  <!-- isotope -->
  <script src="/assets/js/jquery.isotope-3.0.6.min.js"></script>
  <!-- waypoints -->
  <script src="/assets/js/waypoints.js"></script>
  <!-- owl carousel -->
  <script src="/assets/js/owl.carousel.min.js"></script>
  <!-- magnific popup -->
  <script src="/assets/js/jquery.magnific-popup.min.js"></script>
  <!-- mean menu -->
  <script src="/assets/js/jquery.meanmenu.min.js"></script>
  <!-- sticker js -->
  <script src="/assets/js/sticker.js"></script>
  <!-- main js -->
  <script src="/assets/js/main.js"></script>

</body>

</html>