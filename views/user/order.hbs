<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

	<!-- title -->
	<title>Cart</title>

	<!-- favicon -->
	{{!-- <link rel="shortcut icon" type="image/png" href="/assets/img/favicon.png"> --}}
		<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">

	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	<!-- fontawesome -->
	<link rel="stylesheet" href="/assets/css/all.min.css">
	<!-- bootstrap -->
	<link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">
	<!-- owl carousel -->
	<link rel="stylesheet" href="/assets/css/owl.carousel.css">
	<!-- magnific popup -->
	<link rel="stylesheet" href="/assets/css/magnific-popup.css">
	<!-- animate css -->
	<link rel="stylesheet" href="/assets/css/animate.css">
	<!-- mean menu css -->
	<link rel="stylesheet" href="/assets/css/meanmenu.min.css">
	<!-- main style -->
	<link rel="stylesheet" href="/assets/css/main.css">
	<!-- responsive -->
	<link rel="stylesheet" href="/assets/css/responsive.css">

</head>
<body>
	
	<!--PreLoader-->
    {{!-- <div class="loader">
        <div class="loader-inner">
            <div class="circle"></div>
        </div>
    </div> --}}
    <!--PreLoader Ends-->
	
	<!-- header -->
	<div class="top-header-area" id="sticker">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 col-sm-12 text-center">
					<div class="main-menu-wrap">
						<!-- logo -->
						<div class="site-logo">
							<a href="/">
								<img src="/assets/img/mainLogo.png" alt="">
							</a>
						</div>
						<!-- logo -->

						<!-- menu start -->
						<nav class="main-menu">
							<ul>
								{{!-- <li class="current-list-item"><a href="/">Home</a>
									<ul class="sub-menu">
										<li><a href="index.html">Static Home</a></li>
										<li><a href="index_2.html">Slider Home</a></li>
									</ul>
								</li> --}}
								<li><a href="/product">Product</a></li>
								<li><a href="#">Pages</a>
									<ul class="sub-menu">
										{{!-- <li><a href="404.html">404 page</a></li> --}}
										{{!-- <li><a href="about.html">About</a></li> --}}
										<li><a href="/cart">Cart</a></li>
										<li><a href="/checkout">Check Out</a></li>
										<li><a href="/product">Product</a></li>
										<li><a href="/order">Order</a></li>
									</ul>
								</li>
								
								{{!-- <li><a href="contact.html">Contact</a></li> --}}
								<li><a href="/product">Shop</a>
									<ul class="sub-menu">
										<li><a href="/product">Product</a></li>
										{{!-- <li><a href="checkout.html">Check Out</a></li> --}}
										{{!-- <li><a href="/singleProduct">Single Product</a></li> --}}
										<li><a href="/cart">Cart</a></li>
									</ul>
								</li>
								<li>
									<div class="header-icons">
										{{!-- <a class="mobile-hide search-bar-icon" href="#" id="search-icon"><i class="fas fa-search"></i></a> --}}
										<a class="shopping-cart" href="/cart"><i class="fas fa-shopping-cart"></i></a>
										<a class="mobile-hide wishlist-bar-icon" href="/wishlist"><i class="bi bi-heart-fill"></i></a>
										<a class="mobile-hide person-bar-icon" href="/profile"><i class="bi bi-person-circle"></i></a>
									</div>
									
								</li>
								
							</ul>
						</nav>
						<a class="mobile-show search-bar-icon" href="#"><i class="fas fa-search"></i></a>
						<div class="mobile-menu"></div>
						<!-- menu end -->
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end header -->

	<!-- search area -->
	<div class="search-area">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<span class="close-btn"><i class="fas fa-window-close"></i></span>
					<div class="search-bar">
						<div class="search-bar-tablecell">
							<h3>Search For:</h3>
							<input type="text" placeholder="Keywords">
							<button type="submit">Search <i class="fas fa-search"></i></button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end search arewa -->
	
	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<p>Dry Vitals</p>
						<h1>Orders</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->


    <div class="container">
        {{!-- <h1 class="text-center mb-4">Order Details</h1> --}}
        <div class="row">
            <div class="col-md-8 mt-5">
                <div class="card order-summary">
                    <div class="card-header">
                        <h2 class="mb-0">Order Summary</h2>
                    </div>
                    {{!-- {{orderDetails.[0].createdAt}} --}}
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>

                                        <th>Payment Method</th>
                                        <th>Price</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                               {{#each orderDetails}}
                    <tr data-order-id="{{this._id}}">
                        <td>{{this.createdAt}}</td>
                        <td>{{this.selectedPaymentMethod}}</td>
                        <td>{{this.totalAmount}}</td>
                        <td>{{this.status}}</td>
                        <td>
                            <button type="button" class="btn btn-primary" data-toggle="modal"
                                data-target="#exampleModalCenter" onclick="getOrderDetails('{{this._id}}')">
                                View
                            </button>
                        </td>
                    </tr>
                {{/each}}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="order-total">

                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mt-5">
                <div class="card delivery-details">
                    <div class="card-header">
                        <h5 class="mb-0">Delivery Address</h5>
                    </div>

                    {{#if orderDetails.length}}
    <div class="card-body">
        <p><strong>Name:</strong> <span id="name">{{orderDetails.[0].userDetails.userName}}</span></p>
        <p><strong>Email:</strong> <span id="email">{{orderDetails.[0].userDetails.email}}</span></p>
        <p><strong>Phone:</strong> <span id="phone">{{orderDetails.[0].userDetails.phoneNumber}}</span></p>
        {{!-- <p><strong>District:</strong> <span id="district">{{orderDetails.[0].userDetails.userAddress.district}}</span></p>
        <p><strong>Place:</strong> <span id="place">{{orderDetails.[0].userDetails.userAddress.place}}</span></p>
        <p><strong>Address:</strong> <span id="address">{{orderDetails.[0].userDetails.userAddress.address}}</span></p>
        <p><strong>Pincode:</strong> <span id="pincode">{{orderDetails.[0].userDetails.userAddress.pincode}}</span></p> --}}
    </div>
{{/if}}




                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btn-cancel">Cancel</button>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
    const viewButtons = document.querySelectorAll('.view-btn');
    viewButtons.forEach(button => {
        button.addEventListener('click', getOrderDetails);
    });
});

        async function getOrderDetails() {
            const orderId = event.target.closest('tr').dataset.orderId;
            console.log(orderId)
            try {
                const response = await axios.get(`/singleOrderDetails/${orderId}`); 
                const details=response.data.singleorder
                showOrderDetails(details);  // Accessing correct property in response data
            } catch (error) {
                console.error('Error fetching order details:', error);
                // Handle error gracefully, e.g., display an error message to the user
            }
        }

function showOrderDetails(details) {
    const modalBody = document.querySelector('.modal-body');
    const closeButton = document.querySelector('[data-dismiss="modal"]');
    const cancelButton = document.getElementById('btn-cancel');
    const modalFooter = document.querySelector('.modal-footer');

    // Clear previous content
    modalBody.innerHTML = '';

    // Display order details
    modalBody.innerHTML = `
        <p>Order ID: ${details[0]._id}</p>
        <input type="hidden" value="${details[0]._id}" id="orderId">
        <p>Created At: ${details[0].createdAt}</p>
        <p>Payment Method: ${details[0].selectedPaymentMethod}</p>
        <p>Total Amount: ${details[0].totalAmount}</p>

    `;
    console.log(details)

    // Loop through each product in the order and display its details
    details.forEach(product => {
        const productDiv = document.createElement('div');
        productDiv.classList.add('product-details');
        productDiv.innerHTML = `
            <div class="card">
                <div class="card-body">
                    <p>Name: ${product.productDetails.productName}</p>
                    <img src="${product.productDetails.imageUrl}" style="width:100px">
                    <p>Price: ${product.cart.product.productPrice}</p>
                    <p>Quantity: ${product.cart.product.quantity}</p>
                    <p>Variant: ${product.cart.product.productVariant}</p>
                </div>
            </div>
        `;
        modalBody.appendChild(productDiv);
    });

    // Toggle display of cancel button based on order cancellation status
    if (details[0].isCancel) {
        cancelButton.style.display = 'none'; // Hide the cancel button
        closeButton.style.display = 'block'; // Show the close button
    } else {
        cancelButton.style.display = 'block'; // Show the cancel button
        closeButton.style.display = 'block'; // Show the close button
        cancelButton.addEventListener('click', handleCancelButtonClick);
    }
}

        // Function to handle the click event on the "Cancel" button
        async function handleCancelButtonClick() {
            const orderId = document.getElementById('orderId').value;
            console.log('cancel orderId',orderId)
            // Display confirmation dialog using SweetAlert
            const isConfirmed = await Swal.fire({
                title: 'Are you sure?',
                text: 'Once cancelled, you will not be able to recover this order!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, cancel it!',
                cancelButtonText: 'No, keep it'
            });

            // Check if user confirmed the action
            if (isConfirmed.isConfirmed) {
                try {
                    const response = await axios.put(`/orders/${orderId}`);

                    if (response.status === 200) {
                        // Show success message
                        Swal.fire('Cancelled!', 'Your order has been cancelled.', 'success')
                            .then(() => {
                                // Refresh the page
                                window.location.reload();
                            });
                    } else {
                        // Show error message
                        Swal.fire('Error!', 'Failed to cancel order.', 'error');
                    }
                } catch (error) {
                    // Show error message
                    Swal.fire('Error!', 'Failed to cancel order.', 'error');
                    console.error('Error cancelling order:', error);
                }
            }
        }

        // Add event listener to the "Cancel" button
        document.getElementById('btn-cancel').addEventListener('click', handleCancelButtonClick);

    </script>



	</script>
	

	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js" integrity="sha512-PJa3oQSLWRB7wHZ7GQ/g+qyv6r4mbuhmiDb8BjSFZ8NZ2a42oTtAq5n0ucWAwcQDlikAtkub+tPVCw4np27WCg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<!-- jquery -->
	<script src="/assets/js/jquery-1.11.3.min.js"></script>
	<!-- bootstrap -->
	<script src="/assets/bootstrap/js/bootstrap.min.js"></script>
	<!-- count down -->
	<script src="/assets/js/jquery.countdown.js"></script>
	<!-- isotope -->
	<script src="/assets/js/jquery.isotope-3.0.6.min.js"></script>
	<!-- waypoints -->
	<script src="/assets/js/waypoints.js"></script>
	<!-- owl carousel -->
	<script src="/assets/js/owl.carousel.min.js"></script>
	<!-- magnific popup -->
	<script src="/assets/js/jquery.magnific-popup.min.js"></script>
	<!-- mean menu -->
	<script src="/assets/js/jquery.meanmenu.min.js"></script>
	<!-- sticker js -->
	<script src="/assets/js/sticker.js"></script>
	<!-- main js -->
	<script src="/assets/js/main.js"></script>

</body>
</html>